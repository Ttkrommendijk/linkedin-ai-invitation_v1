<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="popup.css" />
    </head>
    <body>
        <div id="sidePanelRoot">
            <div id="topTabs">
                <button
                    id="openSidePanel"
                    type="button"
                    class="btn-small-secondary"
                >
                    Open in side panel
                </button>
                <div class="tabs">
                    <button
                        id="tabMainBtn"
                        class="tab-btn active"
                        type="button"
                    >
                        Detail
                    </button>
                    <button id="tabOverviewBtn" class="tab-btn" type="button">
                        List
                    </button>
                    <button id="tabConfigBtn" class="tab-btn" type="button">
                        Configuration
                    </button>
                </div>
            </div>

            <div id="innerContentContainer" class="app-content-scroll">
                <div id="tabMain" class="tab-panel active">
                    <div class="detail-person">
                        <div class="detail-person-top">
                            <div
                                id="detailPersonName"
                                class="detail-person-name"
                            >
                                -
                            </div>
                            <button
                                id="enrichProfileBtn"
                                type="button"
                                class="btn-enrich"
                                title="Enrich data with AI"
                            >
                                🪄
                            </button>
                        </div>
                        <div id="detailCompany" class="detail-person-company">
                            -
                        </div>
                        <div id="detailHeadline" class="detail-person-headline">
                            -
                        </div>
                    </div>

                    <div id="statusStepper" class="status-stepper">
                        <div id="step-register" class="status-step">
                            <div class="status-circle"></div>
                            <div class="status-label">Register</div>
                        </div>
                        <div id="step-invited" class="status-step">
                            <div class="status-circle"></div>
                            <div class="status-label">Invited</div>
                        </div>
                        <div id="step-accepted" class="status-step">
                            <div class="status-circle"></div>
                            <div class="status-label">Accepted</div>
                        </div>
                        <div id="step-first-message-sent" class="status-step">
                            <div class="status-circle"></div>
                            <div class="status-label">1st sent</div>
                        </div>
                        <div id="step-message-responded" class="status-step">
                            <div class="status-circle"></div>
                            <div class="status-label">Responded</div>
                        </div>
                    </div>
                    <div class="status-actions">
                        <button
                            id="statusBackBtn"
                            type="button"
                            class="btn-back"
                        ></button>
                        <button
                            id="statusForwardBtn"
                            type="button"
                            class="btn-forward"
                        ></button>
                    </div>

                    <div class="row inline detail-tabs">
                        <button
                            id="detailTabInviteBtn"
                            class="detail-tab-btn active"
                            type="button"
                        >
                            Invitation
                        </button>
                        <button
                            id="detailTabFirstMessageBtn"
                            class="detail-tab-btn"
                            type="button"
                        >
                            First Message
                        </button>
                        <button
                            id="detailTabFollowBtn"
                            class="detail-tab-btn"
                            type="button"
                        >
                            Follow
                        </button>
                    </div>

                    <div id="detailInviteSection">
                        <div class="row">
                            <label
                                ><small
                                    >Standard invite prompt
                                    <button
                                        id="toggleInvitePrompt"
                                        type="button"
                                        aria-expanded="false"
                                    >
                                        Show
                                    </button></small
                                ></label
                            >
                            <div id="invitePromptWrap" hidden>
                                <textarea
                                    id="invitePromptPreview"
                                    readonly
                                ></textarea>
                            </div>
                        </div>

                        <div class="row">
                            <label
                                ><small
                                    >Additional prompt (optional)</small
                                ></label
                            >
                            <small class="field-help"
                                >Use this to guide the invite context for this
                                person. This text will be appended to the
                                standard prompt.</small
                            >
                            <small class="invite-tip"
                                >Tip: Invites have the highest success when
                                there are no extra notes. Only add a note when
                                you genuinely know the person from somewhere,
                                then reference that specific occurrence.</small
                            >
                            <input
                                id="focus"
                                placeholder="e.g. S&OP + Slimstock + SAP S/4HANA go-live"
                            />
                        </div>

                        <button id="generate" type="button">
                            Generate invite
                        </button>

                        <div class="row">
                            <small>Preview</small>
                            <pre id="preview"></pre>
                        </div>
                        <button id="copyBtn" type="button">Copy</button>
                    </div>

                    <div id="detailMessageMount"></div>
                </div>

                <div id="tabMessage" class="tab-panel">
                    <div class="row">
                        <label><small>Language</small></label>
                        <select id="messageLanguage">
                            <option value="Portuguese" selected>
                                Portuguese
                            </option>
                            <option value="English">English</option>
                            <option value="Dutch">Dutch</option>
                            <option value="Spanish">Spanish</option>
                        </select>
                    </div>
                    <div id="acceptedMode">
                        <div id="initialMessageSection">
                            <div class="row">
                                <label
                                    ><small
                                        >Message prompt
                                        <button
                                            id="togglePrompt"
                                            type="button"
                                            aria-expanded="false"
                                        >
                                            Show prompt
                                        </button></small
                                    ></label
                                >
                                <div id="firstPromptContainer">
                                    <textarea id="messagePrompt">
Escreva a melhor primeira mensagem apos aceitar conexao no LinkedIn, em portugues.
Objetivo estrategico: abrir uma conversa com friccao minima e incentivar resposta curta.

Regras obrigatorias:
1. Agradeca por aceitar a conexao.
2. Cite uma referencia factual especifica do perfil (empresa, cargo, area de atuacao, etc).
3. Mantenha tom peer-level, neutro, especifico e nao comercial.
4. Nao faca pitch de servicos.
5. Nao elogie excessivamente.
6. Nao use adjetivos emocionais.
7. Nunca invente fatos; use apenas profile_context e profile_excerpt_fallback.

Estrutura:
- Maximo 2 paragrafos curtos.
- O segundo paragrafo deve conter:
  - Uma observacao afirmativa leve sobre o contexto profissional da pessoa.
  - Uma pergunta simples de validacao, que possa ser respondida com sim/nao ou frase curta.
  - Evite perguntas amplas, reflexivas ou que exijam explicacoes longas.

Evitar completamente:
- "quais foram os aprendizados"
- "como voce enxerga"
- "poderia compartilhar"
- perguntas profundas ou conceituais
- convite direto para reuniao
- emojis, hashtags ou bullets

A pergunta final deve reduzir friccao e facilitar resposta rapida. Sem emojis, hashtags ou bullets. Nunca invente fatos; use somente profile_context e profile_excerpt_fallback.</textarea
                                    >
                                    <div class="inline">
                                        <button
                                            id="saveMessagePrompt"
                                            type="button"
                                        >
                                            Save prompt
                                        </button>
                                        <button
                                            id="resetMessagePrompt"
                                            type="button"
                                        >
                                            Reset to default
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <button id="generateFirstMessage" type="button">
                                Generate first message
                            </button>
                        </div>

                        <div id="firstMessagePreviewSection">
                            <div class="row">
                                <small>First message preview</small>
                                <pre id="firstMessagePreview"></pre>
                            </div>

                            <button id="copyFirstMessage" type="button">
                                Copy
                            </button>
                            <button id="markFirstMessageSent" type="button">
                                Message sent
                            </button>
                        </div>
                    </div>

                    <div id="firstMessageSentMode" hidden>
                        <div class="row">
                            <label><small>Chat history</small></label>
                            <textarea
                                id="chatHistory"
                                readonly
                                placeholder="Chat history will appear here…"
                            ></textarea>
                            <button id="refreshChatHistory" type="button">
                                Refresh history
                            </button>
                        </div>
                        <div id="followupSection">
                            <div class="row">
                                <label><small>Objective</small></label>
                                <textarea
                                    id="followupObjective"
                                    placeholder="Objective for the next message…"
                                ></textarea>
                            </div>
                            <div class="row">
                                <label class="checkbox-row">
                                    <input
                                        type="checkbox"
                                        id="includeStrategy"
                                        class="strategy-checkbox"
                                        checked
                                    />
                                    <small>Include strategy</small>
                                </label>
                            </div>
                            <button id="generateFollowup" type="button">
                                Generate follow-up
                            </button>
                            <div class="row">
                                <small>Communication status</small>
                                <div id="commStatusBar">Idle</div>
                            </div>
                            <div class="row">
                                <small>Generated message preview</small>
                                <textarea id="followupPreview"></textarea>
                            </div>
                            <button id="copyFollowup" type="button">
                                Copy
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tabOverview" class="tab-panel">
                    <div class="overview-filters row">
                        <input
                            id="overviewCampaignFilter"
                            placeholder="Campaign"
                        />
                        <select id="overviewArchivedFilter">
                            <option value="">Archived: All</option>
                            <option value="0">Archived: 0</option>
                            <option value="1">Archived: 1</option>
                        </select>
                        <select id="overviewStatusFilter">
                            <option value="">Status: All</option>
                            <option value="generated">generated</option>
                            <option value="invited">invited</option>
                            <option value="accepted">accepted</option>
                            <option value="first message sent">
                                first message sent
                            </option>
                        </select>
                        <input
                            id="overviewSearch"
                            placeholder="Search name/company"
                        />
                    </div>

                    <div class="overview-grid-wrap row">
                        <div
                            id="overviewLoading"
                            class="overview-loading"
                            hidden
                        >
                            Loading…
                        </div>
                        <table class="overview-grid overview-table">
                            <colgroup>
                                <col class="overview-col-open" />
                                <col class="overview-col-archive" />
                                <col class="overview-col-name" />
                                <col class="overview-col-company" />
                                <col class="overview-col-status" />
                                <col class="overview-col-date" />
                                <col class="overview-col-campaign" />
                                <col class="overview-col-archived" />
                            </colgroup>
                            <thead>
                                <tr>
                                    <th>Open</th>
                                    <th>Archive</th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="full_name"
                                        >
                                            Name
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="full_name"
                                            ></span>
                                        </button>
                                    </th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="company"
                                        >
                                            Company
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="company"
                                            ></span>
                                        </button>
                                    </th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="status"
                                        >
                                            Status
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="status"
                                            ></span>
                                        </button>
                                    </th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="most_relevant_date"
                                        >
                                            Most relevant date
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="most_relevant_date"
                                            ></span>
                                        </button>
                                    </th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="campaign"
                                        >
                                            Campaign
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="campaign"
                                            ></span>
                                        </button>
                                    </th>
                                    <th>
                                        <button
                                            type="button"
                                            class="sort-btn"
                                            data-overview-sort="archived"
                                        >
                                            Archived
                                            <span
                                                class="sort-indicator"
                                                data-overview-sort-indicator="archived"
                                            ></span>
                                        </button>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="overviewTbody"></tbody>
                        </table>
                    </div>

                    <div class="overview-pagination row">
                        <select id="overviewPageSize">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                        </select>
                        <button id="overviewPrevBtn" type="button">Prev</button>
                        <button id="overviewNextBtn" type="button">Next</button>
                        <div id="overviewCountLabel">Total: ?</div>
                    </div>
                </div>

                <div id="tabConfig" class="tab-panel">
                    <div class="row">
                        <label><small>OpenAI API key (saved)</small></label>
                        <input
                            id="apiKey"
                            type="password"
                            placeholder="sk-..."
                        />
                    </div>

                    <div class="row">
                        <label><small>Model (saved)</small></label>
                        <input id="model" placeholder="gpt-4.1" />
                    </div>

                    <div class="row">
                        <label><small>Strategy (saved)</small></label>
                        <textarea
                            id="strategy"
                            placeholder="Paste your strategy core here (saved)."
                        ></textarea>
                    </div>

                    <div class="row">
                        <label><small>Webhook base URL (saved)</small></label>
                        <input
                            id="webhookBaseUrl"
                            placeholder="https://yourdomain.com"
                        />
                    </div>

                    <div class="row">
                        <label><small>Webhook secret (saved)</small></label>
                        <input
                            id="webhookSecret"
                            type="password"
                            placeholder="shared secret"
                        />
                    </div>

                    <button id="saveConfig" type="button">Save config</button>

                    <div class="row">
                        <small>Tip</small>
                        <div>
                            <small
                                >Edits are saved when you click "Save config" or
                                "Generate".</small
                            >
                        </div>
                    </div>
                </div>
            </div>
            <div id="commFooter" class="comm-status-footer">
                <small>Ready</small>
                <div id="commFooterText">Ready</div>
            </div>
        </div>

        <script src="../shared/utils.js"></script>
        <script src="../prompts.js"></script>
        <script src="popup.js"></script>
    </body>
</html>
